<!DOCTYPE html>
<html>
<head>
    <title>Spotify OAuth - Get Refresh Token</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .button {
            background: #1DB954;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 24px;
            font-size: 16px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
        }
        .button:hover {
            background: #1aa34a;
        }
        .token-box {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
            word-break: break-all;
            font-family: monospace;
        }
        .instructions {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .error {
            background: #ffebee;
            border: 1px solid #ffcdd2;
            padding: 15px;
            border-radius: 8px;
            color: #c62828;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéµ Spotify Auth Helper</h1>
        
        <div id="login-section">
            <p>This tool helps you get a refresh token for the Spotify API.</p>
            
            <h3>‚ö†Ô∏è Important: Use a Premium Account</h3>
            <p>Spotify Connect API requires a Premium subscription.</p>
            
            <h3>Instructions:</h3>
            <ol>
                <li>Click the button below to log in with Spotify</li>
                <li>Authorize the app</li>
                <li>You'll be redirected back here with your token</li>
            </ol>
            
            <a href="#" id="login-button" class="button">Login with Spotify</a>
        </div>
        
        <div id="result-section" style="display: none;">
            <h2>‚úÖ Success!</h2>
            
            <div class="instructions">
                <h3>‚ö†Ô∏è Note: Implicit Flow Limitation</h3>
                <p>The implicit flow doesn't provide refresh tokens. You'll need to use the authorization code flow with a backend server.</p>
                <p>For the MVP, you have two options:</p>
                <ol>
                    <li><strong>Use Postman</strong> to get a refresh token (recommended)</li>
                    <li><strong>Use ngrok</strong> to expose your localhost with HTTPS</li>
                </ol>
            </div>
            
            <h3>Option 1: Use Postman (Recommended)</h3>
            <ol>
                <li>Download <a href="https://www.postman.com/downloads/" target="_blank">Postman</a></li>
                <li>Create a new request</li>
                <li>Go to Authorization tab</li>
                <li>Select OAuth 2.0</li>
                <li>Configure:
                    <ul>
                        <li>Grant Type: Authorization Code</li>
                        <li>Callback URL: https://oauth.pstmn.io/v1/callback</li>
                        <li>Auth URL: https://accounts.spotify.com/authorize</li>
                        <li>Access Token URL: https://accounts.spotify.com/api/token</li>
                        <li>Client ID: <code>481d9d974c6c4b519fac67e51565e405</code></li>
                        <li>Client Secret: <code>0b4463c4611748bea7df3afc28413e77</code></li>
                        <li>Scope: <code>user-modify-playback-state user-read-playback-state playlist-read-private user-read-currently-playing</code></li>
                    </ul>
                </li>
                <li>Add <code>https://oauth.pstmn.io/v1/callback</code> to your Spotify app's redirect URIs</li>
                <li>Click "Get New Access Token"</li>
                <li>The refresh token will be shown in the response</li>
            </ol>
            
            <h3>Option 2: Use ngrok</h3>
            <pre>
# Install ngrok
brew install ngrok

# In one terminal, run the auth script with HTTP:
# (First edit the script to set USE_HTTPS = false)
pnpm spotify:auth

# In another terminal, expose it with ngrok:
ngrok http 8888

# Use the HTTPS URL from ngrok as your redirect URI
            </pre>
        </div>
    </div>
    
    <script>
        // Your app credentials
        const CLIENT_ID = '481d9d974c6c4b519fac67e51565e405';
        const REDIRECT_URI = window.location.href.split('?')[0].split('#')[0];
        const SCOPES = [
            'user-modify-playback-state',
            'user-read-playback-state', 
            'playlist-read-private',
            'playlist-read-collaborative',
            'user-read-currently-playing',
            'user-read-playback-position'
        ].join(' ');
        
        // Check for token in URL
        const hash = window.location.hash.substring(1);
        const params = new URLSearchParams(hash);
        const accessToken = params.get('access_token');
        
        if (accessToken) {
            document.getElementById('login-section').style.display = 'none';
            document.getElementById('result-section').style.display = 'block';
        }
        
        // Set up login button
        document.getElementById('login-button').addEventListener('click', (e) => {
            e.preventDefault();
            
            const authUrl = new URL('https://accounts.spotify.com/authorize');
            authUrl.searchParams.append('client_id', CLIENT_ID);
            authUrl.searchParams.append('response_type', 'token');
            authUrl.searchParams.append('redirect_uri', REDIRECT_URI);
            authUrl.searchParams.append('scope', SCOPES);
            authUrl.searchParams.append('show_dialog', 'true');
            
            window.location.href = authUrl.toString();
        });
    </script>
</body>
</html>